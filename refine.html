<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2685.1">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Times; -webkit-text-stroke: #000000}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Times; -webkit-text-stroke: #000000; min-height: 14.0px}
    span.s1 {font-kerning: none}
  </style>
</head>
<body>
<p class="p1"><span class="s1">&lt;!DOCTYPE html&gt;</span></p>
<p class="p1"><span class="s1">&lt;html&gt;</span></p>
<p class="p1"><span class="s1">&lt;head&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  </span>&lt;meta charset="UTF-8" /&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  </span>&lt;title&gt;Music Preferences Visualizer (ECharts)&lt;/title&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  </span>&lt;meta name="viewport" content="width=device-width, initial-scale=1.0" /&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  </span>&lt;!-- Telegram WebApp script --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  </span>&lt;script src="https://telegram.org/js/telegram-web-app.js"&gt;&lt;/script&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  </span>&lt;!-- ECharts library --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  </span>&lt;script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"&gt;&lt;/script&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  </span>&lt;style&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>body {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>font-family: Arial, sans-serif; margin: 10px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>background: #f0f0f0; color: #333;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>h2 { text-align: center; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>#charts { display: flex; flex-direction: column; align-items: center; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>.chart-box { width: 300px; height: 300px; max-width: 90%; margin: 20px 0; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>#controls { margin: 10px 0; text-align: center; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>#sliders .slider-row {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>margin: 5px 0; display: flex; align-items: center;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>.slider-row span.dim-name { width: 200px; text-align: right; margin-right: 10px; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>.slider-row input[type=range] { flex: 1; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>.slider-row span.dim-value { width: 40px; text-align: left; margin-left: 10px; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>#year-controls { margin: 10px 0; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>#year-controls select { margin: 0 5px; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>#applyBtn { padding: 8px 16px; font-size: 16px; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  </span>&lt;/style&gt;</span></p>
<p class="p1"><span class="s1">&lt;/head&gt;</span></p>
<p class="p1"><span class="s1">&lt;body&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  </span>&lt;h2&gt;ðŸŽµ Refine Your Music Profile&lt;/h2&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  </span>&lt;div id="charts"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>&lt;div id="mainRadar" class="chart-box"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>&lt;div id="detailRadar" class="chart-box"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  </span>&lt;div id="controls"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>&lt;label for="categorySelect"&gt;&lt;strong&gt;Category:&lt;/strong&gt;&lt;/label&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>&lt;select id="categorySelect"&gt;&lt;/select&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  </span>&lt;div id="sliders"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  </span>&lt;div id="year-controls"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>&lt;label&gt;&lt;strong&gt;Year From:&lt;/strong&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;select id="yearFrom"&gt;&lt;/select&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>&lt;/label&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>&lt;label&gt;&lt;strong&gt;To:&lt;/strong&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;select id="yearTo"&gt;&lt;/select&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>&lt;/label&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  </span>&lt;div style="text-align:center;"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>&lt;button id="applyBtn"&gt;âœ… Apply Changes&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  </span>&lt;script&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>(() =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>const tg = window.Telegram.WebApp;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>tg.expand();</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>// 1. Parse initial vector and year range from URL</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>const urlParams = new URLSearchParams(window.location.search);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>const vectorParam = urlParams.get('vector');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>let initialVector = [];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>if (vectorParam) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>initialVector = vectorParam.split(',').map(x =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>const val = parseInt(x, 10);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>return isNaN(val) ? 0 : val;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>while (initialVector.length &lt; 58) initialVector.push(0);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>initialVector = initialVector.slice(0, 58);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>const yearFromParam = urlParams.get('year_from');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>const yearToParam <span class="Apple-converted-space">Â  </span>= urlParams.get('year_to');</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>// 2. Define categories and sub-dimension labels</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>const categories = [</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>{ name: "Vocals", length: 7, labels: [</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>"Vocal Register", "Vocal Timbre Thin/Full", "Vocal Breathiness",</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>"Vocal Smoothness", "Vocal Grittiness", "Vocal Nasality", "Vocal Accompaniment"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>] },</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>{ name: "Harmony", length: 2, labels: [</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>"Minor/Major Tonality", "Harmonic Sophistication"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>] },</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>{ name: "Rhythm", length: 10, labels: [</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>"Tempo", "Cut Time Feel", "Triple Meter", "Compound Meter", "Odd Meter",</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>"Swing Feel", "Shuffle Feel", "Syncopation", "Backbeat", "Danceability"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>] },</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>{ name: "Instrumentation", length: 16, labels: [</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>"Drum Set", "Drum Aggressiveness", "Synthetic Drums", "Percussion",</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>"Electric Guitar", "Guitar Distortion", "Acoustic Guitar", "String Ensemble",</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>"Horn Ensemble", "Piano", "Organ", "Rhodes", "Synthesizer", "Synth Timbre",</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>"Bass Guitar", "Reed Instrument"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>] },</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>{ name: "Lyrics", length: 8, labels: [</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>"Angry Lyrics", "Sad Lyrics", "Happy Lyrics", "Humorous Lyrics", "Love Lyrics",</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>"Political Lyrics", "Abstract Lyrics", "Explicit Lyrics"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>] },</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>{ name: "Sonority", length: 6, labels: [</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>"Live Recording", "Audio Production", "Aural Intensity",</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>"Acoustic Sonority", "Electric Sonority", "Synthetic Sonority"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>] },</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>{ name: "Composition", length: 9, labels: [</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>"Focus Lead Vocal", "Focus Lyrics", "Focus Melody", "Focus Vocal Acc.",</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>"Focus Groove", "Focus Arrangement", "Focus Form", "Focus Riffs", "Focus Performance"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>] }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>let idx = 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>categories.forEach(cat =&gt; { cat.start = idx; idx += cat.length; });</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>// 3. Populate category select options</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>const categorySelect = document.getElementById('categorySelect');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>categories.forEach((cat, i) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const opt = document.createElement('option');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>opt.value = i;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>opt.textContent = cat.name;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>categorySelect.appendChild(opt);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>categorySelect.value = "0";</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>// 4. Populate year range select options</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>const yearFromSel = document.getElementById('yearFrom');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>const yearToSel <span class="Apple-converted-space">Â  </span>= document.getElementById('yearTo');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>const minYear = 1900, maxYear = 2025;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>for (let y = minYear; y &lt;= maxYear; y++) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const optF = document.createElement('option');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>optF.value = y; optF.textContent = y;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>yearFromSel.appendChild(optF);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const optT = document.createElement('option');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>optT.value = y; optT.textContent = y;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>yearToSel.appendChild(optT);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>yearFromSel.value = yearFromParam || minYear;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>yearToSel.value <span class="Apple-converted-space">Â  </span>= yearToParam <span class="Apple-converted-space">Â  </span>|| maxYear;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>// 5. Helper: calculate category averages</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>function calcCategoryAverages(vec) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>return categories.map(cat =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>let sum = 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>for (let j = 0; j &lt; cat.length; j++) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>let val = vec[cat.start + j];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>if (isNaN(val)) val = 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>sum += val;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>return cat.length ? Math.round(sum / cat.length) : 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>let categoryData = calcCategoryAverages(initialVector);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>// 6. Initialize ECharts radar instances</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>const mainChart <span class="Apple-converted-space">Â  </span>= echarts.init(document.getElementById('mainRadar'));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>const detailChart = echarts.init(document.getElementById('detailRadar'));</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>// Main 7-category radar configuration</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>const mainOption = {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>tooltip: {},<span class="Apple-converted-space">Â  </span>// hover tooltip</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>radar: {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>indicator: categories.map(cat =&gt; ({ name: cat.name, max: 100 })),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>radius: '70%'<span class="Apple-converted-space">Â  </span>// size of radar relative to container</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>series: [{</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>name: 'Overall Profile',</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>type: 'radar',</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>data: [{ value: categoryData, name: 'Profile' }],</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>areaStyle: { opacity: 0.2 },</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>itemStyle: { color: '#884EA0' }<span class="Apple-converted-space">Â  </span>// purple</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}]</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>};</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>mainChart.setOption(mainOption);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>// 7. Function to render detail radar and sliders for a given category</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>function renderDetailCategory(catIndex) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const cat = categories[catIndex];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>// Prepare detail radar option for this category</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const indicators = cat.labels.map(label =&gt; ({ name: label, max: 100 }));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const values = initialVector.slice(cat.start, cat.start + cat.length).map(v =&gt; isNaN(v) ? 0 : v);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const detailOption = {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>tooltip: {},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>radar: {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>indicator: indicators,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>radius: '70%'</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>series: [{</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>name: cat.name + " Details",</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>type: 'radar',</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>data: [{ value: values, name: cat.name }],</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>areaStyle: { opacity: 0.2 },</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>itemStyle: { color: '#36A2EB' }<span class="Apple-converted-space">Â  </span>// blue</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>}]</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>};</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>detailChart.setOption(detailOption, true);<span class="Apple-converted-space">Â  </span>// notMerge: replace previous option</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>// Build sliders for this category's sub-dimensions</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const slidersDiv = document.getElementById('sliders');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>slidersDiv.innerHTML = "";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>for (let j = 0; j &lt; cat.length; j++) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>const dimIndex = cat.start + j;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>const dimName<span class="Apple-converted-space">Â  </span>= cat.labels[j];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>const dimValue = isNaN(initialVector[dimIndex]) ? 0 : initialVector[dimIndex];</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>const row = document.createElement('div');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>row.className = 'slider-row';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>const nameSpan = document.createElement('span');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>nameSpan.className = 'dim-name';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>nameSpan.textContent = dimName;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>const slider = document.createElement('input');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>slider.type = 'range'; slider.min = 0; slider.max = 100;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>slider.value = dimValue;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>slider.dataset.index = dimIndex;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>const valueSpan = document.createElement('span');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>valueSpan.className = 'dim-value';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>valueSpan.textContent = dimValue;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>// Slider input event: update values and charts</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>slider.addEventListener('input', () =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const val = parseInt(slider.value, 10);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const idx = parseInt(slider.dataset.index, 10);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>initialVector[idx] = isNaN(val) ? 0 : val;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>valueSpan.textContent = val;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>// Update detail chart's data for this category</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const newValues = initialVector.slice(cat.start, cat.start + cat.length);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>detailChart.setOption({ series: [{ data: [{ value: newValues, name: cat.name }] }] });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>// Update main chart's average for this category</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const newAvg = calcCategoryAverages(initialVector)[catIndex];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>categoryData[catIndex] = newAvg;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>mainChart.setOption({ series: [{ data: [{ value: categoryData, name: 'Profile' }] }] });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>row.appendChild(nameSpan);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>row.appendChild(slider);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>row.appendChild(valueSpan);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>slidersDiv.appendChild(row);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>// 8. Initial render for category 0</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>renderDetailCategory(0);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>// 9. Handle category selection change</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>categorySelect.addEventListener('change', () =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const newIdx = parseInt(categorySelect.value, 10);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>renderDetailCategory(newIdx);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>// 10. Apply changes (send data to bot)</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>document.getElementById('applyBtn').addEventListener('click', () =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const fromYear = parseInt(yearFromSel.value, 10);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const toYear <span class="Apple-converted-space">Â  </span>= parseInt(yearToSel.value, 10);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>if (fromYear &gt; toYear) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>alert("The 'From Year' must be &lt;= 'To Year'.");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const data = {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>vector: initialVector.map(x =&gt; Math.round(x)),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>year_from: fromYear,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>year_to: toYear</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>};</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>tg.sendData(JSON.stringify(data));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>tg.close();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>})();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  </span>&lt;/script&gt;</span></p>
<p class="p1"><span class="s1">&lt;/body&gt;</span></p>
<p class="p1"><span class="s1">&lt;/html&gt;</span></p>
</body>
</html>
